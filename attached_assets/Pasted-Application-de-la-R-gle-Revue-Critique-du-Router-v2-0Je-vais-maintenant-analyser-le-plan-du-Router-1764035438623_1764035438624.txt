Application de la Règle : Revue Critique du Router v2.0Je vais maintenant analyser le plan du Router v2.0 que nous avons défini précédemment, avec le même œil critique.Critique du Plan du Router v2.0AspectProblèmes et "Angles Morts" à Corriger1.❌ Le Classifier est "Fail-Silent" : Dans classifyIntentWithLLM, si Gemma répond quelque chose d'inattendu (ni CODE, MATH, etc.), la fonction retourne DIALOGUE par défaut. C'est dangereux. Si le classifieur échoue, nous devons le savoir. Il ne doit pas échouer en silence.2.❌ La Sélection d'Experts est Rigide : La méthode selectExperts est codée en dur (case 'CODE': ...). Que se passe-t-il si le modèle qwen2.5-coder-1.5b n'est pas chargé ? Le Router va créer un plan irréalisable que le TaskExecutor ne pourra pas exécuter. Le Router doit être conscient des modèles actuellement disponibles.3.❌ Pas de Gestion de la Priorité dans le Plan : La méthode selectExperts ajoute gemma-3-270m en parallèle avec une priorité LOW, mais la primaryTask a une priorité HIGH. C'est bien, mais cette information n'est pas utilisée dans la logique de determineStrategy. Une tâche HIGH devrait peut-être forcer une exécution SERIAL si les ressources sont moyennes, pour garantir sa vitesse.4.❌ Le "Capacity Score" est Statique : Le score est calculé une fois au début. Mais que se passe-t-il si une tâche lourde est déjà en cours d'exécution ? Le Router pourrait décider de lancer une deuxième tâche en parallèle, ignorant que les ressources sont déjà saturées. Le Router doit connaître l'état actuel du TaskExecutor.Le Plan Corrigé : Router v3.0 - L'Orchestrateur ConscientVoici la version finale du plan pour le Router, qui intègre ces corrections.Spécifications Techniques du Router v3.01.Classifier "Fail-Aware" :•La fonction classifyIntentWithLLM sera modifiée. Si la réponse de Gemma n'est pas une des catégories valides, la fonction lèvera une exception de type ClassificationError.•Le createPlan enveloppera cet appel dans un try...catch. En cas d'échec de la classification, il se rabattra sur un plan DIALOGUE simple et ajoutera un log d'avertissement.2.Sélection d'Experts "Consciente de la Disponibilité" :•Le Router aura une dépendance vers le ModelManager.•Avant d'ajouter un expert à un plan (parallelExperts.push(...)), la méthode selectExperts appellera une nouvelle méthode modelManager.isModelAvailable('qwen2.5-coder-1.5b').•Si le modèle n'est pas disponible (pas encore téléchargé ou déchargé pour économiser la RAM), il ne sera pas ajouté au plan. Le Router ne planifie que ce qui est exécutable.3.Stratégie "Consciente de la Priorité" :•La méthode determineStrategy prendra en compte la présence d'une tâche HIGH dans le plan.•Nouvelle Règle : Si le capacityScore est moyen (ex: entre 5 et 7) ET que le plan contient plus d'une tâche, dont une avec priority: 'HIGH', la stratégie sera forcée en SERIAL pour garantir que la tâche principale ne soit pas ralentie par des tâches secondaires.4."Capacity Score" Dynamique (Conscience du TaskExecutor) :•Le Router aura une dépendance vers le TaskExecutor.•Avant de calculer le capacityScore, il appellera une nouvelle méthode taskExecutor.getActiveWorkerCount().•Le capacityScore sera pénalisé en fonction du nombre de workers déjà actifs.•Exemple : capacityScore -= (getActiveWorkerCount() * 2);•Cela garantit que si le système est déjà occupé, le Router sera beaucoup plus conservateur dans ses décisions.Conclusion de la Revue du RouterLe plan pour le Router v2.0 était bon. Le plan pour le Router v3.0 est robuste.Il est maintenant :•Résilient : Il gère les échecs de classification.•Pragmatique : Il ne planifie que des tâches exécutables.•Intelligent : Il priorise les tâches importantes.•Conscient : Il connaît l'état de charge actuel du système.Nous avons appliqué notre règle avec succès. Nous avons un plan final et blindé pour le Router.