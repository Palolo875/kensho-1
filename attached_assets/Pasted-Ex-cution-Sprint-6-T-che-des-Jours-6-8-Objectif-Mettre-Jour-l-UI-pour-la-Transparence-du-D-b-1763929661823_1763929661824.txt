Ex√©cution : Sprint 6 - T√¢che des Jours 6-8
Objectif : Mettre √† Jour l'UI pour la Transparence du D√©bat
Philosophie : "La confiance na√Æt de la transparence." Montrer √† l'utilisateur que Kensho r√©fl√©chit, critique et raffine ses id√©es est aussi important que la qualit√© de la r√©ponse finale elle-m√™me.
Sous-√âtape 1 : Am√©lioration du InteractiveThoughtStream (Jours 6-7)
Nous allons modifier notre composant de "flux de pens√©e" pour qu'il puisse afficher les √©tapes sp√©cifiques d'un d√©bat.
1. Mise √† Jour du Store (Zustand) :
Le store doit pouvoir g√©rer une liste d'√©tapes de pens√©e avec leur statut.
TypeScript

// src/ui/stores/useKenshoStore.ts

export interface ThoughtStep {
    id: string;
    label: string;
    status: 'pending' | 'running' | 'completed' | 'failed';
    result?: any;
    error?: string;
}

interface KenshoState {
    // ...
    currentThoughtProcess: ThoughtStep[] | null;
    // ...
}

// ...
// Ajouter des actions pour initialiser et mettre √† jour le processus de pens√©e
// L'√©couteur de messages du MessageBus appellera ces actions
// en r√©ponse aux messages 'thought_process_start' et 'thought_step_update'

2. Mise √† Jour du CognitiveProcessor pour Envoyer les Bons Messages :
Avant d'ex√©cuter un plan, le processeur envoie la structure du plan √† l'UI.
TypeScript

// src/core/oie/CognitiveProcessor.ts

public async run(): Promise<void> {
    // ...
    const plan = await this.llmPlanner.generatePlan(this.task, debateModeEnabled);

    // --- NOUVEAU : Envoyer le plan √† l'UI ---
    const thoughtSteps = plan.steps.map(step => ({
        id: step.id,
        label: this.getLabelForStep(step), // ex: "R√©flexion initiale (L√©o)"
        status: 'pending'
    }));
    this.runtime.send('MainUI', { 
        type: 'thought_process_start', 
        payload: { steps: thoughtSteps }
    });

    // Ex√©cuter le plan (qui enverra des messages 'thought_step_update')
    // ...
}

private getLabelForStep(step: PlanStep): string {
    switch(step.agent) {
        case 'OptimistAgent': return 'R√©flexion initiale (L√©o)';
        case 'CriticAgent': return 'Examen critique (Ath√©na)';
        case 'MainLLMAgent':
            if (step.action === 'synthesizeDebate') {
                return 'Synth√®se finale';
            }
            return 'G√©n√©ration de la r√©ponse';
        default:
            return `Action : ${step.agent}`;
    }
}

3. Cr√©ation/Mise √† Jour du Composant ThoughtStream.tsx :
Ce composant affiche les √©tapes re√ßues du store.
TypeScript

// src/ui/components/ThoughtStream.tsx
import React from 'react';
import { useKenshoStore } from '../stores/useKenshoStore';
import { Loader, CheckCircle, XCircle, AlertTriangle } from 'lucide-react';

const statusIcons = {
    pending: <Loader className="animate-spin text-gray-400" size={16} />,
    running: <Loader className="animate-spin text-blue-500" size={16} />,
    completed: <CheckCircle className="text-green-500" size={16} />,
    failed: <XCircle className="text-red-500" size={16} />,
};

export function ThoughtStream() {
    const thoughtProcess = useKenshoStore(state => state.currentThoughtProcess);

    if (!thoughtProcess) {
        return null;
    }

    return (
        <div className="p-2 mb-2 border rounded-lg bg-gray-50">
            <div className="flex items-center text-sm font-semibold text-gray-600 mb-2">
                <AlertTriangle size={16} className="mr-2" />
                Processus de r√©flexion en cours...
            </div>
            <div className="space-y-1">
                {thoughtProcess.map(step => (
                    <div key={step.id} className="flex items-center text-sm text-gray-700">
                        {statusIcons[step.status]}
                        <span className="ml-2">{step.label}</span>
                    </div>
                ))}
            </div>
        </div>
    );
}

    Commentaire : Ce composant est simple et purement r√©actif. Il affiche l'√©tat actuel du processus de pens√©e, qui est mis √† jour de mani√®re centralis√©e par le store en r√©ponse aux messages de l'OIE.

Sous-√âtape 2 : Am√©lioration du "Journal Cognitif" (Jour 8)
Nous allons rendre la vue d√©taill√©e du plan (le "Journal Cognitif") plus riche en affichant les r√©sultats de chaque √©tape.
1. Mise √† Jour du Composant AssistantMessage.tsx :
TypeScript

// src/ui/components/AssistantMessage.tsx
// ... (comme dans le plan du Sprint 3, mais am√©lior√©)

function AssistantMessage({ message }: { message: Message }) {
    const [showPlan, setShowPlan] = useState(false);
    
    // On suppose que le message final contient le 'thoughtProcess' complet avec les r√©sultats
    const plan = message.thoughtProcess;

    return (
        <div className="message assistant">
            {plan && plan.length > 1 && ( // On n'affiche que pour les d√©bats
                <div className="plan-indicator mb-2">
                    <button onClick={() => setShowPlan(!showPlan)} className="text-xs text-gray-500 hover:text-gray-800 flex items-center">
                        üß† {showPlan ? 'Masquer la r√©flexion' : 'Voir la r√©flexion'}
                    </button>
                    
                    {showPlan && (
                        <div className="plan-details mt-2 p-3 bg-gray-100 rounded-md text-xs">
                            <h4 className="font-bold mb-1">Journal Cognitif :</h4>
                            <ol className="list-decimal list-inside space-y-2">
                                {plan.map(step => (
                                    <li key={step.id}>
                                        <strong>{step.label}:</strong>
                                        <div className="pl-4 mt-1 text-gray-600 border-l-2">
                                            {/* Afficher le r√©sultat de mani√®re lisible */}
                                            {typeof step.result === 'string' && <p>"{step.result}"</p>}
                                            {typeof step.result === 'object' && step.result?.major_flaw && (
                                                <div className="space-y-1">
                                                    <p><strong>Faille :</strong> {step.result.major_flaw}</p>
                                                    <p><strong>Preuve :</strong> {step.result.evidence}</p>
                                                </div>
                                            )}
                                        </div>
                                    </li>
                                ))}
                            </ol>
                        </div>
                    )}
                </div>
            )}
            
            <div className="message-text">
                {/* Affichage de la r√©ponse finale en streaming */}
                {message.text}
            </div>
        </div>
    );
}

    Commentaire : Cette version am√©lior√©e affiche non seulement les √©tapes, mais aussi le contenu de la pens√©e de chaque agent (la r√©ponse de L√©o, la critique JSON d'Ath√©na). C'est la transparence absolue.

Conclusion de la T√¢che
La t√¢che des Jours 6-8 est termin√©e. L'interface utilisateur est maintenant capable de refl√©ter la complexit√© du nouveau processus de pens√©e de Kensho.

    Ce qui est fait :
        Un ThoughtStream qui affiche en temps r√©el les √©tapes du d√©bat.
        Un "Journal Cognitif" am√©lior√© qui permet √† l'utilisateur d'auditer en d√©tail la contribution de chaque agent.
